<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>全文搜索之 Elasticsearch  - D 的个人博客</title><meta name="description" content="Elasticsearch 是一个基于 Lucene 的开源搜索引擎，它不但稳定、可靠、快速，而且也具有良好的水平扩展能力，是专门为分布式环境设计的。"/><meta property="og:description" content="Elasticsearch 是一个基于 Lucene 的开源搜索引擎，它不但稳定、可靠、快速，而且也具有良好的水平扩展能力，是专门为分布式环境设计的。"/>    <meta name="keywords" content="88250"/><link rel="dns-prefetch" href="https://88250.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://88250.github.io"><link rel="icon" type="image/png" href="https://img.hacpai.com/avatar/1353745196354_1572999872077.png?imageView2/1/w/256/h/256/q/100"/><link rel="apple-touch-icon" href="https://img.hacpai.com/avatar/1353745196354_1572999872077.png?imageView2/1/w/256/h/256/q/100"><link rel="shortcut icon" type="image/x-icon" href="https://img.hacpai.com/avatar/1353745196354_1572999872077.png?imageView2/1/w/256/h/256/q/100"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="全文搜索之 Elasticsearch  - D 的个人博客"/><meta property="og:site_name" content="D 的个人博客"/><meta property="og:url"      content="https://88250.github.io/full-text-search-elasticsearch?"/><meta property="og:image" content="https://img.hacpai.com/avatar/1353745196354_1572999872077.png?imageView2/1/w/256/h/256/q/100"/><link rel="search" type="application/opensearchdescription+xml" title="全文搜索之 Elasticsearch  - D 的个人博客" href="/opensearch.xml"><link href="https://88250.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://88250.github.io/manifest.json">        <link rel="canonical" href="https://88250.github.io/full-text-search-elasticsearch">        <link rel="stylesheet"
              href="https://88250.github.io/skins/Pinghsu/css/base.css?1578534237516"/>
            <link rel="prev" title="细节见真功之 Javadoc" href="https://88250.github.io/when-the-little-things-count-javadoc">
            <link rel="next" title="为什么又要造一个叫 Latke 的轮子" href="https://88250.github.io/why-latke-exists">
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144185520-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144185520-1');
</script></head>
<body>
<header class="header">
    <div class="wrapper">
        <a href="https://88250.github.io" rel="start" class="header__logo">
            <img src="https://img.hacpai.com/avatar/1353745196354_1572999872077.png?imageView2/1/w/128/h/128/interlace/0/q/100"/>
            D 的个人博客
        </a>

        <nav class="header__nav mobile__none">
            <a href="https://88250.github.io/tags.html" rel="section">
                Tags
            </a>
            <a href="https://88250.github.io/archives.html">
                Archives
            </a>
            <a rel="archive" href="https://88250.github.io/links.html">
                Links
            </a>
        </nav>

        <div class="header__bar fn__none" onclick="$(this).next().slideToggle()">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                <path fill="#444" d="M0 3h20v2h-20v-2zM0 9h20v2h-20v-2zM0 15h20v2h-20v-2z"></path>
            </svg>
        </div>
        <main class="header__menu fn__none">
            <ul>
                    <li>
                        <a href="/about" target="_self" rel="section">
                            关于我
                        </a>
                    </li>
                    <li>
                        <a href="/my-github-repos" target="_self" rel="section">
                            我的开源
                        </a>
                    </li>
                    <li>
                        <a href="https://hacpai.com" target="_blank" rel="section">
                            黑客派
                        </a>
                    </li>
                    <li>
                        <a href="https://b3log.org" target="_blank" rel="section">
                            B3log
                        </a>
                    </li>
                <li>
                    <a href="https://88250.github.io/tags.html" rel="section">
                        Tags
                    </a>
                </li>
                <li>
                    <a href="https://88250.github.io/archives.html">
                        Archives
                    </a>
                </li>
                <li>
                    <a rel="archive" href="https://88250.github.io/links.html">
                        Links
                    </a>
                </li>
                <li>
                    <a rel="alternate" href="https://88250.github.io/rss.xml" rel="section">
                        RSS
                    </a>
                </li>
            </ul>
        </main>
    </div>
</header><main id="pjax" class="fn__flex-1">
    
    <div class="post wrapper wrapper--miner">
        <h2 class="item__title">
            <a rel="bookmark" href="https://88250.github.io/full-text-search-elasticsearch">
                全文搜索之 Elasticsearch 
            </a>
        </h2>
        <div class="ft__fade item__meta">
                Published on
            <time>
                Jun 24, 2014
            </time>
            with <span data-uvstaturl="https://88250.github.io/full-text-search-elasticsearch">0</span> views
                and <a href="#comments">4 comments</a>
        </div>
        <div class="item__tags">
                <a rel="tag" class="tag tag--0" href="https://88250.github.io/tags/Full-text%20Search">
                    <b># Full-text Search</b>
                </a>
                <a rel="tag" class="tag tag--1" href="https://88250.github.io/tags/%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2">
                    <b># 全文搜索</b>
                </a>
                <a rel="tag" class="tag tag--2" href="https://88250.github.io/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">
                    <b># 搜索引擎</b>
                </a>
                <a rel="tag" class="tag tag--3" href="https://88250.github.io/tags/Elasticsearch">
                    <b># Elasticsearch</b>
                </a>
                <a rel="tag" class="tag tag--4" href="https://88250.github.io/tags/Distributed">
                    <b># Distributed</b>
                </a>
                <a rel="tag" class="tag tag--5" href="https://88250.github.io/tags/Cloud">
                    <b># Cloud</b>
                </a>
        </div>
        <div class="vditor-reset">
            <p></p><h3 id="b3_solo_h3_0">概述</h3>
<p><a href="http://www.elasticsearch.org" target="_blank">Elasticsearch</a>&nbsp;（ES）是一个基于 <a href="http://lucene.apache.org" target="_blank">Lucene</a>&nbsp;的开源搜索引擎，它不但稳定、可靠、快速，而且也具有良好的水平扩展能力，是专门为分布式环境设计的。</p>
<h3 id="b3_solo_h3_1">特性</h3>
<ul>
<li>安装方便：没有其他依赖，下载后安装非常方便；只用修改几个参数就可以搭建起来一个集群</li>
<li>JSON：输入/输出格式为 JSON，意味着不需要定义 Schema，快捷方便</li>
<li>RESTful：基本所有操作（索引、查询、甚至是配置）都可以通过 HTTP 接口进行</li>
<li>分布式：节点对外表现对等（每个节点都可以用来做入口）；加入节点自动均衡</li>
<li>多租户：可根据不同的用途分索引；可以同时操作多个索引</li>
</ul>
<h3 id="b3_solo_h3_2">集群</h3>
<p>其中一个节点就是一个 ES 进程，多个节点组成一个集群。一般每个节点都运行在不同的操作系统上，配置好集群相关参数后 ES 会自动组成集群（节点发现方式也可以配置）。集群内部通过 ES 的选主算法选出主节点（目前版本 1.2 存在脑裂问题），而集群外部则是可以通过任何节点进行操作，无主从节点之分（对外表现对等/去中心化，有利于客户端编程，例如故障重连）。</p>
<h3 id="b3_solo_h3_3">索引</h3>
<p>“索引”有两个意思：</p>
<ul>
<li>作为动词，它指的是把一个文档“保存”到 ES 中的过程，索引一个文档后，我们就可以使用 ES 搜索到这个文档</li>
<li>作为名词，它是指保存文档的地方，相当于一个数据库概念中的“库”</li>
</ul>
<p>为了方便理解，我们可以将 ES 中的一些概念对应到我们熟悉的关系型数据库上：</p>
<table border="1">
<tbody>
<tr>
<td>&nbsp; &nbsp; ES &nbsp; &nbsp;</td>
<td>&nbsp; &nbsp; 索引 &nbsp; &nbsp;</td>
<td>&nbsp; &nbsp; 类型 &nbsp; &nbsp;</td>
<td>&nbsp; &nbsp; 文档 &nbsp; &nbsp;</td>
</tr>
<tr>
<td>&nbsp; &nbsp; DB &nbsp; &nbsp;</td>
<td>&nbsp; &nbsp; 库 &nbsp; &nbsp;&nbsp;</td>
<td>&nbsp; &nbsp; 表</td>
<td>&nbsp; &nbsp; 行</td>
</tr>
</tbody>
</table>
<h3 id="b3_solo_h3_4">分片</h3>
<p>ES 是一个分布式系统，我们一开始就应该以集群的方式来使用它。它保存索引时会选择适合的“<strong>主</strong>分片”（Primary Shard），把索引保存到其中（我们可以把分片理解为一块物理存储区域）。分片的分法是固定的，而且是安装时候就必须要决定好的（默认是 5），后面就不能改变了。</p>
<p>既然有主分片，那肯定是有“从”分片的，在 ES 里称之为“副本分片”（Replica Shard）。副本分片主要有两个作用：</p>
<ul>
<li>高可用：某分片节点挂了的话可走其他副本分片节点，节点恢复后上面的分片数据可通过其他节点恢复</li>
<li>负载均衡：ES 会自动根据负载情况控制搜索路由，副本分片可以将负载均摊</li>
</ul>
<h3 id="b3_solo_h3_5">一个示例</h3>
<p>来个示例总结一下上面的内容（结合下面的图一起看）：</p>
<ul>
<li>3 个 ES 节点（es-58/59/60）组成一个集群</li>
<li>搭建集群时使用默认的主分片数 5，shard0~shard4</li>
<li>该集群内有加入两个索引 index1、index2</li>
<li>这两个索引中分别“索引”（保存）了两个文档</li>
<li>index1 索引中这个文档被 ES 自动保存到了分片 2 中，主分片在 es-58 节点，副本分片在 es-59 节点</li>
<li>index2 索引中这个文档被 ES 自动保存到了分片 2 中，主分片在 es-59 节点，副本分片在 es-58 节点</li>
</ul>
<p><a href="https://bte68g.dm2301.livefilestore.com/y2pAJb557TDyzvbuqPlMN8lPnUt1XF_E34dXPY_g-9OMyI6tI8Yg416U4sbOHB0f-UnqvzArLcwORneU-CbSsPbONR3f6IGU2T6_DJzMQ2MPEM/shards.png?psid=1?imageView2/2/w/1280/format/jpg/interlace/1/q/100" class="fancybox" data-fancybox-group="group" target="_blank"><img src="https://bte68g.dm2301.livefilestore.com/y2pAJb557TDyzvbuqPlMN8lPnUt1XF_E34dXPY_g-9OMyI6tI8Yg416U4sbOHB0f-UnqvzArLcwORneU-CbSsPbONR3f6IGU2T6_DJzMQ2MPEM/shards.png?psid=1?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="shards" width="433" height="300"></a></p>
<p>（该图是使用 ES 的 RESTful 接口获取的，后面会介绍常用接口）</p>
<h3 id="b3_solo_h3_6">多租户</h3>
<p>ES 的多租户简单的说就是通过多索引机制同时提供给多种业务使用，每种业务使用一个索引（关于多租户的详细定义与用途，可以参考<a href="http://88250.b3log.org/cloud-app-platform-multitenancy" target="_blank">这里</a>）。前面我们提到过可以把索引理解为关系型数据库里的库，那多索引可以理解为一个数据库系统建立多个库给不同的业务使用。</p>
<p>在实际使用时，我们可以通过每个租户一个索引的方式将他们的数据进行隔离，并且每个索引是可以单独配置参数的（可对特定租户进行调优），这在典型的多租户场景下非常有用：例如我们的一个多租户应用需要提供搜索支持，这时可以通过 ES 根据租户建立索引，这样每个租户就可以在自己的索引下搜索相关内容了。</p>
<h3 id="b3_solo_h3_7">RESTful</h3>
<p>这个特性非常方便，最关键的是 ES 的 HTTP 接口不只是可以进行业务操作（索引/搜索），还可以进行配置，甚至是关闭 ES 集群。下面我们介绍几个很常用的接口：</p>
<ul>
<li>&nbsp;/_cat/nodes?v：查集群状态</li>
<li>/_cat/shards?v：查看分片状态</li>
<li>/${index}/${type}/_search：搜索</li>
</ul>
<p>v 是 verbose 的意思，这样可以更可读（有表头，有对齐），_cat 是监测相关的 APIs，/_cat?help 来获取所有接口。${index} 和 ${type} 分别是具体的某一索引某一类型，是分层次的。我们也可以直接在所有索引所有类型上进行搜索：/_search。</p>
<h3 id="b3_solo_h3_8">官方术语表</h3>
<p>最后，来份官方的术语表翻译，巩固一下理解：</p>
<h4 id="b3_solo_h4_9">analysis 分析</h4>
<p>分析是将文本（text）转化为查询词（term）的过程。使用不同的分析器，这三种短语：FOO BAR，Foo-Bar，foo,bar 都有可能被分解成查询词 foo 与 bar。这些查询词实际上将被存储在索引中。一次对 FoO:bAR 的全文查询（不是查询词查询）可能会被分析为为查询词 foo,bar，可以匹配上保存在索引中的查询词。这就是分析处理过程（包含了索引与搜索），它使得 es 可以进行全文查询。</p>
<h4 id="b3_solo_h4_10">cluster 集群</h4>
<p>一个或多个拥有同一个集群名称的节点组成了一个集群。每个集群都会自动选出一个主节点，如果该主节点故障，则集群会自动选出新的主节点来替换故障节点。</p>
<h4 id="b3_solo_h4_11">document 文档</h4>
<p>一个文档就是一个保存在 es 中的 JSON 文本，可以把它理解为关系型数据库表中的一行。每个文档都是保存在索引中的，拥有一种类型和 id。一个文档是一个 JSON 对象（一些语言中的 hash / hashmap / associative array）包含了 0 或多个字段（键值对）。原始的 JSON 文本在索引后将被保存在 _source 字段里，搜索完成后返回值中默认是包含该字段的。</p>
<h4 id="b3_solo_h4_12">id</h4>
<p>Id 是用于标识文档的，一个文档的索引/类型/id 必须是唯一的。文档 id 是自动生成的（如果不指定）。</p>
<h4 id="b3_solo_h4_13">field 字段</h4>
<p>一个文档包含了若干字段，或称之为键值对。字段的值可以是简单（标量）值（例如字符串、整型、日期），也可以是嵌套结构，例如数组或对象。一个字段类似于关系型数据库表中的一列。每个字段的映射都有一个字段类型（不要和文档类型搞混了），它描述了这个字段可以保存的值类型，例如整型、字符串、对象。映射还可以让我们定义一个字段的值如何进行分析。</p>
<h4 id="b3_solo_h4_14">index 索引</h4>
<p>一个索引类似关系型数据库中的一个数据库，它可以映射为多种类型。一个索引就是逻辑上的一个命名空间，对应到 1 或多个主分片上，可以拥有 0 个或多个副本分片。</p>
<h4 id="b3_solo_h4_15">mapping 映射</h4>
<p>一个映射类似于关系型数据库中的模式定义。每个索引都存在一个映射，它定义了该索引中的每一种类型，以及索引相关的配置。映射可以显示定义，或者在文档被索引时自动创建。</p>
<h4 id="b3_solo_h4_16">node 节点</h4>
<p>一个节点是集群中的一个 es 运行实例。测试时，多个节点可以同时启在同一个服务器上，生产环境一般是一个服务器上一个节点。节点启动时将使用单播（或者是组播）来发现和自己配置的集群名称相同的集群，并尝试加入到该集群中。</p>
<h4 id="b3_solo_h4_17">primary shard 主分片</h4>
<p>每个文档都会被保存在一个主分片上。当我们索引一个文档时，它将在一个主分片上进行索引，然后才放到该主分片的各副本分片上。默认情况下，一个索引有 5 个主分片。我们可以指定更少或更多的主分片来伸缩索引可处理的文档数。需要注意的是，一旦索引创建，就不能修改主分片个数。</p>
<h4 id="b3_solo_h4_18">replica shard 副本分片</h4>
<p>每个主分片可以拥有 0 个或多个副本分片。一个副本分片是主分片的一份拷贝，这样做有两个主要原因：</p>
<ol>
<li>故障转移：当主分片失效时，一个副本分片会被提升为主分片</li>
<li>提高性能：获取与搜索请求可以被主分片或副本分片处理。默认情况下，每个主分片都有一个副本分片，副本分片的数量可以动态调整。在同一个节点上，副本分片和其主分片不会同时运行</li>
</ol>
<h4 id="b3_solo_h4_19">routing 路由</h4>
<p>当我们索引一个文档时，它将被保存在一个主分片上，分片的选择是通过路由值哈希得到的。默认情况下，路由值来自于文档 id，如果该文档指定来了父文档，则路由值来自于父文档 id（这是为了确保子文档和父文档被保存在相同的分片上）。该值可以在索引时指定，也可以通过映射路由字段来指定。</p>
<h4 id="b3_solo_h4_20">shard 分片</h4>
<p>一个分片就是一个 Lucene 实例，它是 es 管理的底层“工作单元”。一个索引是逻辑上的一个命名空间，指向主分片和副本分片。索引的主分片和副本分片数量必须明确指定好，在应用代码使用时只需要处理和索引的交互，不会涉及到和分片的交互。Elasticsearch 会在集群中的所有节点上设置好分片，但节点失效或加入新节点时会自动将移动节点分片。</p>
<h4 id="b3_solo_h4_21">source field 源字段</h4>
<p>默认情况下，在获取和搜索请求返回值中的&nbsp;_source 字段保存了源 JSON 文本，这使得我们可以直接在返回结果中访问源数据，而不需要根据 id 再发一次检索请求。注意：索引的 JSON 字符串将完整返回，无论是否是一个合法的 JSON。该字段的内容也不会描述数据如何被索引。</p>
<h4 id="b3_solo_h4_22">term 查询词</h4>
<p>一个查询词是一个被 es 索引的确切值。查询词 foo，Foo，FOO 是不同的。查询词可以使用查询词查询接口进行获取。</p>
<h4 id="b3_solo_h4_23">text 文本</h4>
<p>文本（或称之为全文）是普通的、非结构化的文本，例如本段话。默认情况下，文本将被分析为查询词，查询词将被保存在索引中。为能够进行全文搜索，文本字段在索引时将被分析为查询词，查询关键字在搜索时也将被分析为查询词，通过对比查询词是否相同而完成全文搜索。</p>
<h4 id="b3_solo_h4_24">type 类型</h4>
<p>一种类型类似于关系型数据库中的一张表。每种类型都有若干字段，可以用于指定给该类型文档。映射定义了该文档中的每个字段如何进行分析。</p>
<h3 id="b3_solo_h3_25">参考</h3>
<ul>
<li><a href="http://www.elasticsearch.org/guide" target="_blank">Elasticsearch Guide</a></li>
<li><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/glossary.html#glossary-mapping" target="_blank">Elasticsearch Glossary of terms</a></li>
</ul>
<p></p>
                <div>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-5357405790190342"
     data-ad-slot="9726081163"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                </div>
        </div>
    </div>
    <div class="post__toc">
<ul class="article__toc">
        <li class="toc__h3">
            <a href="#b3_solo_h3_0">概述</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_1">特性</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_2">集群</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_3">索引</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_4">分片</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_5">一个示例</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_6">多租户</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_7">RESTful</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_8">官方术语表</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_9">analysis 分析</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_10">cluster 集群</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_11">document 文档</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_12">id</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_13">field 字段</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_14">index 索引</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_15">mapping 映射</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_16">node 节点</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_17">primary shard 主分片</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_18">replica shard 副本分片</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_19">routing 路由</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_20">shard 分片</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_21">source field 源字段</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_22">term 查询词</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_23">text 文本</a>
        </li>
        <li class="toc__h4">
            <a href="#b3_solo_h4_24">type 类型</a>
        </li>
        <li class="toc__h3">
            <a href="#b3_solo_h3_25">参考</a>
        </li>
</ul>    </div>
    <div class="body--gray post__gray">
        <div class="wrapper comment">
<div class="comment__title">
    Responses
</div>
     <textarea rows="3" placeholder="Your comment here. Be cool. " id="comment"></textarea>

<ul id="comments">
<li id="1556521166897" class="item">
    <div class="fn__clear">
        <div class="item__avatar" style="background-image: url(https://avatars0.githubusercontent.com/u/11781439?v=4)"></div>
        <div class="item__name">
            <a class="ft__link" href="https://88250.b3log.org" target="_blank">DHclly</a>

        </div>
    </div>
    <div class="vditor-reset">
    <p>太棒了！！！，博客也好棒</p>
    </div>
    <div class="item__meta fn__clear">
        <time>
        Apr 29, 2019
        </time>
            <a class="fn__right fn__none item__reply"
               href="javascript:page.toggleEditor('1556521166897', 'DHclly')">Reply</a>
    </div>
</li><li id="1528883839603" class="item">
    <div class="fn__clear">
        <div class="item__avatar" style="background-image: url(https://secure.gravatar.com/avatar/8165c494249aa4fa15e6094d49260b92?s=128)"></div>
        <div class="item__name">
            <a class="ft__link" href="https://yq.aliyun.com/u/zhipeng" target="_blank">Lean.li</a>

        </div>
    </div>
    <div class="vditor-reset">
    <p>受教了?</p>
    </div>
    <div class="item__meta fn__clear">
        <time>
        Jun 14, 2018
        </time>
            <a class="fn__right fn__none item__reply"
               href="javascript:page.toggleEditor('1528883839603', 'Lean.li')">Reply</a>
    </div>
</li><li id="1509344212033" class="item">
    <div class="fn__clear">
        <div class="item__avatar" style="background-image: url(https://secure.gravatar.com/avatar/725596efab6c2388a1d2d96b0e99b9e9?s=128)"></div>
        <div class="item__name">
            <a class="ft__link" href="http://blog.lingfei.info" target="_blank">Linfy</a>

        </div>
    </div>
    <div class="vditor-reset">
    <p>? 找到老大这里来了</p>
    </div>
    <div class="item__meta fn__clear">
        <time>
        Oct 30, 2017
        </time>
            <a class="fn__right fn__none item__reply"
               href="javascript:page.toggleEditor('1509344212033', 'Linfy')">Reply</a>
    </div>
</li><li id="1478765454100" class="item">
    <div class="fn__clear">
        <div class="item__avatar" style="background-image: url(https://secure.gravatar.com/avatar/9307e76051d9242d36c796817475ca37?s=128)"></div>
        <div class="item__name">
                <span class="ft__fade">刘玉通</span>

        </div>
    </div>
    <div class="vditor-reset">
    <p>怎么快速解析出获取_source中的正文</p>
    </div>
    <div class="item__meta fn__clear">
        <time>
        Nov 11, 2016
        </time>
            <a class="fn__right fn__none item__reply"
               href="javascript:page.toggleEditor('1478765454100', '刘玉通')">Reply</a>
    </div>
</li></ul>

            <div class="post__list fn__flex">
                <div class="fn__flex-1">
                    <div id="externalRelevantArticles"></div>
                </div>
                <div class="post__list-mid fn__flex-1">
                    <div id="randomArticles"></div>
                </div>
                <div class="fn__flex-1">
                    <div id="relevantArticles"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="post__fix">
        <div class="wrapper">
            <span class="post__share mobile__none">
                Share
                <span class="tag tag--4" data-type="weibo">WeiBo</span>
                <span class="tag tag--5" data-type="twitter">Twitter</span>
                <span class="tag tag--6" data-type="qqz">QZone</span>
                <span class="post__code tag tag--7"
                      data-type="wechat"
                      data-title="全文搜索之 Elasticsearch "
                      data-blogtitle="D 的个人博客"
                      data-url="https://88250.github.io/full-text-search-elasticsearch"
                      data-avatar="https://img.hacpai.com/avatar/1353745196354_1572999872077.png?imageView2/1/w/128/h/128/interlace/0/q/100">WeChat</span>
            </span>
            <span class="post__arrow">
                    <a href="https://88250.github.io/when-the-little-things-count-javadoc" rel="prev"
                       class="vditor-tooltipped__n vditor-tooltipped"
                       pjax-title="细节见真功之 Javadoc"
                       aria-label="旧一篇: 细节见真功之 Javadoc">←</a>

                    <a href="https://88250.github.io/why-latke-exists" rel="next"
                       class="vditor-tooltipped__n vditor-tooltipped"
                       pjax-title="为什么又要造一个叫 Latke 的轮子"
                       aria-label="新一篇: 为什么又要造一个叫 Latke 的轮子">→</a>
                <a href="javascript:Util.goTop()" class="vditor-tooltipped__n vditor-tooltipped"
                   aria-label="移动到顶部">↑</a>
                <a href="javascript:Util.goBottom()" class="vditor-tooltipped__n vditor-tooltipped"
                   aria-label="移动到底部">↓</a>
            </span>
        </div>
    </div>
    
</main>
<footer class="footer">
    <div class="ft__center">
    <a href="https://hacpai.com/member/88250"
       aria-label="https://hacpai.com/member/88250"
       class="vditor-tooltipped__n vditor-tooltipped  user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>

        <a href="https://github.com/88250"
           aria-label="https://github.com/88250"
           class="vditor-tooltipped__n vditor-tooltipped  user__site"
           target="_blank" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M16 0.331c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z"></path>
            </svg>
        </a>

    </div>
    <nav class="footer__nav mobile__none">
            <a class="ft__link" href="/about" target="_self" rel="section">
                关于我
            </a>
            <a class="ft__link" href="/my-github-repos" target="_self" rel="section">
                我的开源
            </a>
            <a class="ft__link" href="https://hacpai.com" target="_blank" rel="section">
                黑客派
            </a>
            <a class="ft__link" href="https://b3log.org" target="_blank" rel="section">
                B3log
            </a>
        <a class="ft__link" rel="alternate" href="https://88250.github.io/rss.xml" rel="section">RSS</a>
    </nav>
    <div class="footer__border mobile__none"></div>
    <div class="wrapper fn__flex">
        <div class="fn__flex-1 mobile__none">
            <div class="ft__fade">88250 - 开源程序员，自由职业者</div>
            <br>
                <div>
小而美的 Java 博客系统 <a style="text-decoration: none;" target="_blank" href="https://solo.b3log.org"><span style="color: orangered; font-weight: bold;">Solo</span></a><br/>
Golang 在线 IDE <a style="text-decoration: none;" target="_blank" href="https://wide.b3log.org"><span style="color: #4183c4; font-weight: 
bold;">Wide</span></a><br/>
黑客与画家的社区 <a style="text-decoration: none;" target="_blank" href="https://hacpai.com/register?r=88250"><span style="color: #f47e00; font-weight: 
bold;">Sym</span></a>
</div>
        </div>

            <div class="footer__mid fn__flex-1 mobile__none">
                <div class="ft__fade">分类</div>
                <br>
                    <a href="https://88250.github.io/category/dev-language"
                       aria-label="36 个标签"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        编程语言</a> &nbsp; &nbsp;
                    <a href="https://88250.github.io/category/past-summary"
                       aria-label="3 个标签"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        往事与总结</a> &nbsp; &nbsp;
                    <a href="https://88250.github.io/category/i-love-opensource"
                       aria-label="29 个标签"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        开源项目</a> &nbsp; &nbsp;
                    <a href="https://88250.github.io/category/linux"
                       aria-label="9 个标签"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        Linux</a> &nbsp; &nbsp;
                    <a href="https://88250.github.io/category/arch"
                       aria-label="3 个标签"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        架构设计</a> &nbsp; &nbsp;
                    <a href="https://88250.github.io/category/database"
                       aria-label="4 个标签"
                       class="ft__link ft__nowrap vditor-tooltipped vditor-tooltipped__n">
                        数据库</a> &nbsp; &nbsp;
            </div>

        <div class="fn__flex-1 footer__copyright">
            <a class="ft__link" href="https://88250.github.io/archives.html">
                404
                文章
            </a> &nbsp; &nbsp;
                2,022
                评论 <br>
            <span data-uvstaturl="https://88250.github.io">0</span> <span class="ft-gray">浏览</span> &nbsp; &nbsp;
            6 <span class="ft-gray">当前访客</span> <br>
            &copy; 2020
            <a class="ft__link" href="https://88250.github.io">D 的个人博客</a>
            
            <br>
            Powered by <a class="ft__link" href="https://solo.b3log.org" target="_blank">Solo</a>
            <br>
            Theme Pinghsu
            <sup>[<a class="ft__link" target="_blank" href="https://github.com/chakhsu/pinghsu">ref</a>]</sup>
            by <a class="ft__link" href="http://vanessa.b3log.org" target="_blank">Vanessa</a>
        </div>
    </div>
</footer>
<script type="text/javascript" src="https://88250.github.io/js/lib/compress/pjax.min.js" charset="utf-8"></script>
<script type="text/javascript" src="https://88250.github.io/js/common.js?1578534237516"
        charset="utf-8"></script>
<script type="text/javascript" src="https://88250.github.io/skins/Pinghsu/js/headroom.js"
        charset="utf-8"></script>
<script type="text/javascript"
        src="https://88250.github.io/skins/Pinghsu/js/common.js?1578534237516"
        charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/uvstat@v1.0.2/dist/index.min.js"></script>
<script>
    var Label = {
        servePath: "https://88250.github.io",
        staticServePath: "https://88250.github.io",
        luteAvailable: false,
        hljsStyle: 'monokai',
        langLabel: "zh_CN",
        version: "3.6.8",
    }
    Util.init()
</script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.1/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.1/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>


<script type="text/javascript">
    Util.addScript('https://88250.github.io/js/page.js?1578534237516', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论内容只能为 2 到 500 个字符！",
        "oId": "1403250925359",
        "blogHost": "https://88250.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "7";
    page.loadRandomArticles('<h3>RECOMMEND POSTS</h3>');
    page.loadExternalRelevantArticles("Full-text Search,全文搜索,搜索引擎,Elasticsearch,Distributed,Cloud",
    '<h3>HACPAI POSTS</h3>');
    page.loadRelevantArticles('1403250925359', '<h3>RELEVANT POSTS</h3>');
Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 203ms, 2020/01/09 09:44:20 -->